<?php
/**
 * Ïñ¥ÌïÑÎ¶¨ÏóêÏù¥Ìä∏ ÏÉÅÌíà Îì±Î°ù ÏûêÎèôÌôî ÏûÖÎ†• ÌéòÏù¥ÏßÄ (AliExpress Í≥µÏãù Ïä§ÌÉÄÏùº - Ï¢åÏö∞ Î∂ÑÌï† + üì± Î∞òÏùëÌòï)
 * ÎÖ∏Î∞îÏÑºÌä∏(novacents.com) Ï†ÑÏö©
 * ÏïåÎ¶¨ÏùµÏä§ÌîÑÎ†àÏä§ Ïñ¥ÌïÑÎ¶¨ÏóêÏù¥Ìä∏ Ï†ÑÏö© ÏÉÅÌíà Í∏Ä ÏÉùÏÑ±
 * + HTML ÏÜåÏä§ ÏÉùÏÑ± Î∞è ÌÅ¥Î¶ΩÎ≥¥Îìú Î≥µÏÇ¨ Í∏∞Îä•
 * + Ïù∏ÎùºÏù∏ ÌÇ§ÏõåÎìú ÏûÖÎ†•Ï∞Ω
 * + üåü AliExpress Í≥µÏãù Ïä§ÌÉÄÏùº HTML Î†àÏù¥ÏïÑÏõÉ (Ï¢åÏö∞ Î∂ÑÌï†)
 * + üé® ÏôºÏ™Ω ÌÅ∞ Ïù¥ÎØ∏ÏßÄ, Ïò§Î•∏Ï™Ω Î™®Îì† Ï†ïÎ≥¥, ÌïòÎã® Íµ¨Îß§ Î≤ÑÌäº
 * + üì± Î™®Î∞îÏùº/ÌÉúÎ∏îÎ¶ø ÏôÑÏ†Ñ Î∞òÏùëÌòï ÏßÄÏõê
 */

// ÏõåÎìúÌîÑÎ†àÏä§ ÌôòÍ≤Ω Î°úÎìú
require_once($_SERVER['DOCUMENT_ROOT'] . '/wp-config.php');

// Í¥ÄÎ¶¨Ïûê Í∂åÌïú ÌôïÏù∏
if (!current_user_can('manage_options')) {
    wp_die('Ï†ëÍ∑º Í∂åÌïúÏù¥ ÏóÜÏäµÎãàÎã§.');
}

// ÌôòÍ≤ΩÎ≥ÄÏàò Î°úÎìú
$env_file = '/home/novacents/.env';
$env_vars = [];
if (file_exists($env_file)) {
    $lines = file($env_file, FILE_IGNORE_NEW_LINES | FILE_SKIP_EMPTY_LINES);
    foreach ($lines as $line) {
        if (strpos($line, '=') !== false && strpos($line, '#') !== 0) {
            list($key, $value) = explode('=', $line, 2);
            $env_vars[trim($key)] = trim($value);
        }
    }
}

// Gemini API Ï†úÎ™© ÏÉùÏÑ± Ï≤òÎ¶¨
if (isset($_POST['action']) && $_POST['action'] === 'generate_titles') {
    header('Content-Type: application/json');
    
    $keywords_input = sanitize_text_field($_POST['keywords']);
    
    if (empty($keywords_input)) {
        echo json_encode(['success' => false, 'message' => 'ÌÇ§ÏõåÎìúÎ•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.']);
        exit;
    }
    
    $keywords = array_map('trim', explode(',', $keywords_input));
    $keywords = array_filter($keywords);
    
    if (empty($keywords)) {
        echo json_encode(['success' => false, 'message' => 'Ïú†Ìö®Ìïú ÌÇ§ÏõåÎìúÎ•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.']);
        exit;
    }
    
    $combined_keywords = implode(',', $keywords);
    
    $script_locations = [
        __DIR__ . '/title_generator.py',
        '/home/novacents/title_generator.py'
    ];
    
    $output = null;
    $found_script = false;

    foreach ($script_locations as $script_path) {
        if (file_exists($script_path)) {
            $script_dir = dirname($script_path);
            $command = "LANG=ko_KR.UTF-8 /usr/bin/env /usr/bin/python3 " . escapeshellarg($script_path) . " " . escapeshellarg($combined_keywords) . " 2>&1";
            
            $descriptorspec = [
                0 => ["pipe", "r"],
                1 => ["pipe", "w"],
                2 => ["pipe", "w"]
            ];
            
            $process = proc_open($command, $descriptorspec, $pipes, $script_dir, null);
            
            if (is_resource($process)) {
                fclose($pipes[0]);
                $output = stream_get_contents($pipes[1]);
                $error_output = stream_get_contents($pipes[2]);
                fclose($pipes[1]);
                fclose($pipes[2]);
                $return_code = proc_close($process);
                
                if ($return_code === 0 && !empty($output)) {
                    $found_script = true;
                    break;
                }
            }
        }
    }
    
    if (!$found_script) {
        echo json_encode(['success' => false, 'message' => 'Python Ïä§ÌÅ¨Î¶ΩÌä∏Î•º Ï∞æÏùÑ Ïàò ÏóÜÍ±∞ÎÇò Ïã§ÌñâÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.']);
        exit;
    }
    
    $result = json_decode(trim($output), true);
    
    if ($result === null) {
        echo json_encode([
            'success' => false, 
            'message' => 'Python Ïä§ÌÅ¨Î¶ΩÌä∏ ÏùëÎãµ ÌååÏã± Ïã§Ìå®.',
            'raw_output' => $output
        ]);
        exit;
    }
    
    echo json_encode($result);
    exit;
}

// URL ÌååÎùºÎØ∏ÌÑ∞Î°ú Ï†ÑÎã¨Îêú Î©îÏãúÏßÄ Ï≤òÎ¶¨
$success_message = '';
$error_message = '';

if (isset($_GET['success']) && $_GET['success'] == '1') {
    $success_message = 'Í∏ÄÏù¥ ÏÑ±Í≥µÏ†ÅÏúºÎ°ú Î∞úÌñâ ÎåÄÍ∏∞Ïó¥Ïóê Ï∂îÍ∞ÄÎêòÏóàÏäµÎãàÎã§!';
}

if (isset($_GET['error'])) {
    $error_message = 'Ïò§Î•ò: ' . urldecode($_GET['error']);
}
?>

<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ïñ¥ÌïÑÎ¶¨ÏóêÏù¥Ìä∏ ÏÉÅÌíà Îì±Î°ù - ÎÖ∏Î∞îÏÑºÌä∏</title>
    <style>
        /* Í∏∞Ï°¥ Ïä§ÌÉÄÏùº Ïú†ÏßÄ + ÏÉàÎ°úÏö¥ Ïä§ÌÉÄÏùº Ï∂îÍ∞Ä */
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
            min-width: 1200px;
            color: #1c1c1c;
        }
        
        .main-container {
            width: 1800px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header-section {
            padding: 30px;
            border-bottom: 1px solid #e0e0e0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .header-section h1 {
            margin: 0 0 10px 0;
            font-size: 28px;
        }
        
        .header-section .subtitle {
            margin: 0 0 20px 0;
            opacity: 0.9;
        }
        
        .header-form {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 20px;
            margin-top: 20px;
        }
        
        .title-section {
            position: relative;
        }
        
        .title-input-row {
            display: flex;
            gap: 10px;
            align-items: flex-end;
        }
        
        .title-input-row input {
            flex: 1;
            padding: 12px;
            border: 1px solid rgba(255,255,255,0.3);
            border-radius: 6px;
            background: rgba(255,255,255,0.1);
            color: white;
            font-size: 16px;
        }
        
        .title-input-row input::placeholder {
            color: rgba(255,255,255,0.7);
        }
        
        .category-section select {
            width: 100%;
            padding: 12px;
            border: 1px solid rgba(255,255,255,0.3);
            border-radius: 6px;
            background: rgba(255,255,255,0.1);
            color: white;
            font-size: 16px;
        }
        
        .category-section select option {
            background: #333;
            color: white;
        }
        
        .main-content {
            display: flex;
            min-height: 600px;
        }
        
        .products-sidebar {
            width: 600px;
            border-right: 1px solid #e0e0e0;
            background: #fafafa;
            display: flex;
            flex-direction: column;
        }
        
        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid #e0e0e0;
            background: white;
        }
        
        .progress-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .progress-text {
            font-weight: bold;
            color: #333;
        }
        
        .progress-bar {
            flex: 1;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            margin: 0 15px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #45a049);
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .products-list {
            flex: 1;
            overflow-y: auto;
            padding: 0;
        }
        
        .keyword-group {
            border-bottom: 1px solid #e0e0e0;
        }
        
        .keyword-header {
            padding: 15px 20px;
            background: white;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
        }
        
        .keyword-header:hover {
            background: #f8f9fa;
        }
        
        .keyword-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .keyword-name {
            font-weight: 600;
            color: #333;
        }
        
        .product-count {
            background: #007bff;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
        }
        
        .keyword-actions {
            display: flex;
            gap: 8px;
        }
        
        .product-item {
            padding: 12px 40px;
            border-bottom: 1px solid #f5f5f5;
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .product-item:hover {
            background: #f0f8ff;
        }
        
        .product-item.active {
            background: #e3f2fd;
            border-left: 4px solid #2196F3;
        }
        
        .product-status {
            font-size: 18px;
            width: 20px;
        }
        
        .product-name {
            flex: 1;
            font-size: 14px;
            color: #555;
        }
        
        .sidebar-actions {
            padding: 15px 20px;
            border-bottom: 1px solid #e0e0e0;
            background: white;
        }
        
        /* üî• ÏÉàÎ°ú Ï∂îÍ∞Ä: Ïù∏ÎùºÏù∏ ÌÇ§ÏõåÎìú ÏûÖÎ†•Ï∞Ω Ïä§ÌÉÄÏùº */
        .keyword-input-section {
            margin-top: 10px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 6px;
            border: 1px solid #e9ecef;
            display: none;
        }
        
        .keyword-input-section.show {
            display: block;
        }
        
        .keyword-input-row-inline {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .keyword-input-row-inline input {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .keyword-input-row-inline button {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
        }
        
        .detail-panel {
            flex: 1;
            width: 1100px;
            padding: 30px;
            overflow-y: auto;
        }
        
        .detail-header {
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        .product-url-section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }
        
        .url-input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .url-input-group input {
            flex: 1;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
        }
        
        .analysis-result {
            margin-top: 15px;
            padding: 20px;
            background: white;
            border-radius: 8px;
            border: 1px solid #ddd;
            display: none;
        }
        
        .analysis-result.show {
            display: block;
        }
        
        /* üé® AliExpress Ï¢åÏö∞Î∂ÑÌï† Ïä§ÌÉÄÏùº ÏÉÅÌíà Ïπ¥Îìú */
        .product-card {
            background: #fff;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.08);
            border: 1px solid #f0f0f0;
            margin-bottom: 20px;
        }
        
        /* üñºÔ∏è Ï¢åÏö∞ Î∂ÑÌï† Î†àÏù¥ÏïÑÏõÉ (Ïù¥ÎØ∏ÏßÄ 400px, Ï†ïÎ≥¥ ÏòÅÏó≠ ÌôïÎåÄ) */
        .product-content-split {
            display: grid;
            grid-template-columns: 400px 1fr;
            gap: 30px;
            align-items: start;
            margin-bottom: 25px;
        }
        
        /* üñºÔ∏è ÏôºÏ™Ω Ïù¥ÎØ∏ÏßÄ (400pxÎ°ú Ï°∞Ï†ï) */
        .product-image-large {
            width: 100%;
        }
        
        .product-image-large img {
            width: 100%;
            max-width: 400px;
            border-radius: 12px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        }
        
        /* üìã Ïò§Î•∏Ï™Ω Ï†ïÎ≥¥ ÏòÅÏó≠ (Îçî ÎÑìÏñ¥Ïßê) */
        .product-info-all {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        /* üè∑Ô∏è AliExpress Î°úÍ≥† (Ïò§Î•∏Ï™Ω ÏÉÅÎã®) */
        .aliexpress-logo-right {
            margin-bottom: 15px;
        }
        
        .aliexpress-logo-right img {
            width: 250px;
            height: 60px;
            object-fit: contain;
        }
        
        /* üìù ÏÉÅÌíàÎ™Ö (Ïò§Î•∏Ï™Ω) - 23px ‚Üí 21pxÎ°ú ÏàòÏ†ï */
        .product-title-right {
            color: #1c1c1c;
            font-size: 21px;
            font-weight: 600;
            line-height: 1.4;
            margin: 0 0 20px 0;
            word-break: keep-all;
            overflow-wrap: break-word;
        }
        
        /* üí∞ Í∞ÄÍ≤© (Ïò§Î•∏Ï™Ω, ÏßÄÏ†ïÎêú Î∞∞Í≤ΩÏÉâ) - 40pxÎ°ú Ï¶ùÍ∞Ä, ÏÑ∏Î°ú Ìå®Îî© 16px ‚Üí 14pxÎ°ú ÏàòÏ†ï */
        .product-price-right {
            background: linear-gradient(135deg, #e62e04 0%, #ff9900 100%);
            color: white;
            padding: 14px 30px;
            border-radius: 10px;
            font-size: 40px;
            font-weight: 700;
            text-align: center;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(230, 46, 4, 0.3);
        }
        
        /* ‚≠ê ÌèâÏ†ê (Ïò§Î•∏Ï™Ω, Í≥†Í∞ùÎßåÏ°±ÎèÑ ÌòïÌÉú) */
        .product-rating-right {
            color: #1c1c1c;
            font-size: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .rating-stars {
            color: #ff9900;
        }
        
        /* üì¶ ÌåêÎß§Îüâ (Ïò§Î•∏Ï™Ω) */
        .product-sales-right {
            color: #1c1c1c;
            font-size: 18px;
            margin-bottom: 15px;
        }
        
        /* üìä Í∏∞ÌÉÄ Ï†ïÎ≥¥ (Ïò§Î•∏Ï™Ω) */
        .product-extra-info-right {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-top: 15px;
        }
        
        .info-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
            font-size: 16px;
        }
        
        .info-row:last-child {
            border-bottom: none;
        }
        
        .info-label {
            color: #666;
            font-weight: 500;
        }
        
        .info-value {
            color: #1c1c1c;
            font-weight: 600;
        }
        
        /* üõí Íµ¨Îß§ Î≤ÑÌäº (ÌïòÎã® Ï†ÑÏ≤¥ Ìè≠) */
        .purchase-button-full {
            text-align: center;
            margin-top: 30px;
            width: 100%;
        }
        
        .purchase-button-full img {
            max-width: 100%;
            height: auto;
            cursor: pointer;
            transition: transform 0.2s ease;
        }
        
        .purchase-button-full img:hover {
            transform: scale(1.02);
        }
        
        /* HTML ÏÜåÏä§ Í¥ÄÎ†® Ïä§ÌÉÄÏùº */
        .html-source-section {
            margin-top: 30px;
            padding: 20px;
            background: #f1f8ff;
            border-radius: 8px;
            border: 1px solid #b3d9ff;
        }
        
        .html-source-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .html-source-header h4 {
            margin: 0;
            color: #0066cc;
            font-size: 18px;
        }
        
        .copy-btn {
            padding: 8px 16px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .copy-btn:hover {
            background: #0056b3;
        }
        
        .copy-btn.copied {
            background: #28a745;
        }
        
        .html-preview {
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
        }
        
        .html-code {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            line-height: 1.4;
            overflow-x: auto;
            white-space: pre;
            color: #333;
            max-height: 300px;
            overflow-y: auto;
        }
        
        /* üé® ÎØ∏Î¶¨Î≥¥Í∏∞ AliExpress Ï¢åÏö∞Î∂ÑÌï† Ïä§ÌÉÄÏùº */
        .preview-product-card {
            display: flex;
            justify-content: center;
            margin: 25px 0;
        }
        
        .preview-card-content {
            border: 2px solid #eee;
            padding: 30px;
            border-radius: 15px;
            background: #f9f9f9;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            max-width: 1000px;
            width: 100%;
        }
        
        /* ÎØ∏Î¶¨Î≥¥Í∏∞ÎèÑ ÎèôÏùºÌïòÍ≤å 400pxÎ°ú Ï°∞Ï†ï */
        .preview-content-split {
            display: grid;
            grid-template-columns: 400px 1fr;
            gap: 30px;
            align-items: start;
            margin-bottom: 25px;
        }
        
        .preview-image-large {
            width: 100%;
            max-width: 400px;
            border-radius: 12px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        }
        
        .preview-info-all {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .preview-aliexpress-logo {
            margin-bottom: 15px;
        }
        
        .preview-aliexpress-logo img {
            width: 250px;
            height: 60px;
            object-fit: contain;
        }
        
        /* ÎØ∏Î¶¨Î≥¥Í∏∞ ÏÉÅÌíàÎ™Ö - 23px ‚Üí 21pxÎ°ú ÏàòÏ†ï */
        .preview-card-title {
            color: #1c1c1c;
            margin: 0 0 20px 0;
            font-size: 21px;
            font-weight: 600;
            line-height: 1.4;
            word-break: keep-all;
            overflow-wrap: break-word;
        }
        
        /* üí∞ ÎØ∏Î¶¨Î≥¥Í∏∞ Í∞ÄÍ≤© - 40pxÎ°ú Ï¶ùÍ∞Ä, ÏÑ∏Î°ú Ìå®Îî© 16px ‚Üí 14pxÎ°ú ÏàòÏ†ï */
        .preview-price-main {
            background: linear-gradient(135deg, #e62e04 0%, #ff9900 100%);
            color: white;
            padding: 14px 30px;
            border-radius: 10px;
            font-size: 40px;
            font-weight: 700;
            text-align: center;
            margin: 0 0 20px 0;
            box-shadow: 0 4px 15px rgba(230, 46, 4, 0.3);
        }
        
        .preview-rating {
            color: #1c1c1c;
            font-size: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 0 0 15px 0;
        }
        
        .preview-rating .rating-stars {
            color: #ff9900;
        }
        
        .preview-sales {
            color: #1c1c1c;
            font-size: 18px;
            margin: 0 0 15px 0;
        }
        
        .preview-button-container {
            text-align: center;
            margin-top: 30px;
        }
        
        .preview-button-container img {
            max-width: 100%;
            height: auto;
            cursor: pointer;
        }
        
        .user-input-section {
            margin-top: 30px;
        }
        
        .input-group {
            margin-bottom: 30px;
            padding: 20px;
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
        }
        
        .input-group h3 {
            margin: 0 0 20px 0;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
            color: #333;
            font-size: 18px;
        }
        
        .form-row {
            display: grid;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .form-row.two-col {
            grid-template-columns: 1fr 1fr;
        }
        
        .form-row.three-col {
            grid-template-columns: 1fr 1fr 1fr;
        }
        
        .form-field label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #333;
            font-size: 14px;
        }
        
        .form-field input,
        .form-field textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            box-sizing: border-box;
        }
        
        .form-field textarea {
            min-height: 60px;
            resize: vertical;
        }
        
        .advantages-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .advantages-list li {
            margin-bottom: 10px;
        }
        
        .advantages-list input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        .navigation-section {
            margin-top: 40px;
            padding-top: 20px;
            border-top: 2px solid #f0f0f0;
            text-align: center;
        }
        
        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-block;
            margin: 0 5px;
        }
        
        .btn-primary {
            background-color: #007bff;
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #0056b3;
        }
        
        .btn-secondary {
            background-color: #6c757d;
            color: white;
        }
        
        .btn-secondary:hover {
            background-color: #545b62;
        }
        
        .btn-success {
            background-color: #28a745;
            color: white;
        }
        
        .btn-success:hover {
            background-color: #1e7e34;
        }
        
        .btn-danger {
            background-color: #dc3545;
            color: white;
        }
        
        .btn-small {
            padding: 6px 12px;
            font-size: 12px;
        }
        
        .btn-large {
            padding: 15px 30px;
            font-size: 16px;
        }
        
        .keyword-generator {
            margin-top: 15px;
            padding: 15px;
            background-color: rgba(255,255,255,0.1);
            border-radius: 6px;
            display: none;
        }
        
        .keyword-input-row {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .keyword-input-row input {
            flex: 1;
            padding: 10px;
            border: 1px solid rgba(255,255,255,0.3);
            border-radius: 4px;
            background: rgba(255,255,255,0.1);
            color: white;
        }
        
        .generated-titles {
            margin-top: 15px;
        }
        
        .title-options {
            display: grid;
            gap: 8px;
        }
        
        .title-option {
            padding: 12px 15px;
            background-color: rgba(255,255,255,0.1);
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: left;
            color: white;
        }
        
        .title-option:hover {
            background-color: rgba(255,255,255,0.2);
            border-color: rgba(255,255,255,0.6);
        }
        
        .loading {
            display: none;
            text-align: center;
            color: rgba(255,255,255,0.8);
            margin-top: 10px;
        }
        
        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,0.3);
            border-top: 3px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .alert {
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
        }
        
        .alert-success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .alert-error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #666;
        }
        
        .empty-state h3 {
            margin: 0 0 10px 0;
            color: #999;
        }
        
        /* Î∞òÏùëÌòï ÎîîÏûêÏù∏ */
        @media (max-width: 1920px) {
            .main-container {
                width: 95%;
                min-width: 1400px;
            }
        }
        
        @media (max-width: 1600px) {
            .main-container {
                transform: scale(0.9);
                transform-origin: top center;
                margin-top: -50px;
            }
        }
        
        /* üì± Î™®Î∞îÏùº/ÌÉúÎ∏îÎ¶ø Î∞òÏùëÌòï CSS (768px Ïù¥Ìïò) */
        @media (max-width: 768px) {
            /* Í∏∞Î≥∏ Î†àÏù¥ÏïÑÏõÉ Î™®Î∞îÏùº ÏµúÏ†ÅÌôî */
            body {
                min-width: unset;
                padding: 10px;
            }
            
            .main-container {
                width: 100%;
                transform: none;
                margin-top: 0;
            }
            
            .header-section {
                padding: 20px;
            }
            
            .header-section h1 {
                font-size: 24px;
            }
            
            .header-form {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .main-content {
                flex-direction: column;
            }
            
            .products-sidebar {
                width: 100%;
                border-right: none;
                border-bottom: 1px solid #e0e0e0;
            }
            
            .detail-panel {
                width: 100%;
                padding: 20px;
            }
            
            /* üì± Î™®Î∞îÏùº ÏÉÅÌíà Ïπ¥Îìú Î†àÏù¥ÏïÑÏõÉ - ÏÑ∏Î°ú Î∞∞Ïπò */
            .product-content-split {
                display: block !important;
                grid-template-columns: none !important;
                gap: 20px;
            }
            
            /* üì± Î™®Î∞îÏùº Ïù¥ÎØ∏ÏßÄ ÌÅ¨Í∏∞ ÏµúÏ†ÅÌôî (300px) */
            .product-image-large {
                text-align: center;
                margin-bottom: 20px;
            }
            
            .product-image-large img {
                max-width: 300px !important;
                width: 90%;
            }
            
            /* üì± Î™®Î∞îÏùº AliExpress Î°úÍ≥† - Ï¢åÏ∏°Ï†ïÎ†¨ */
            .aliexpress-logo-right {
                text-align: left !important;
                margin-bottom: 15px;
            }
            
            .aliexpress-logo-right img {
                width: 200px;
                height: 48px;
            }
            
            /* üì± Î™®Î∞îÏùº ÏÉÅÌíàÎ™Ö - Ï¢åÏ∏°Ï†ïÎ†¨, ÌÅ¨Í∏∞ Ï°∞Ï†ï */
            .product-title-right {
                text-align: left !important;
                font-size: 18px !important;
                line-height: 1.3;
                margin-bottom: 15px !important;
            }
            
            /* üì± Î™®Î∞îÏùº Í∞ÄÍ≤© Î∞ïÏä§ ÏµúÏ†ÅÌôî */
            .product-price-right {
                font-size: 28px !important;
                padding: 12px 20px !important;
                margin-bottom: 15px !important;
            }
            
            /* üì± Î™®Î∞îÏùº ÌèâÏ†ê ÏµúÏ†ÅÌôî */
            .product-rating-right {
                font-size: 16px !important;
                flex-direction: column;
                align-items: flex-start !important;
                gap: 5px !important;
                margin-bottom: 12px !important;
            }
            
            /* üì± Î™®Î∞îÏùº ÌåêÎß§Îüâ ÏµúÏ†ÅÌôî */
            .product-sales-right {
                font-size: 16px !important;
                margin-bottom: 12px !important;
            }
            
            /* üì± Î™®Î∞îÏùº Í∏∞ÌÉÄ Ï†ïÎ≥¥ Ïà®Í∏∞Í∏∞ */
            .product-extra-info-right {
                display: none;
            }
            
            /* üì± Î™®Î∞îÏùº Íµ¨Îß§ Î≤ÑÌäº ÏµúÏ†ÅÌôî */
            .purchase-button-full {
                margin-top: 20px;
            }
            
            /* üì± Î™®Î∞îÏùº ÎØ∏Î¶¨Î≥¥Í∏∞ÎèÑ ÎèôÏùºÌïòÍ≤å Ï†ÅÏö© */
            .preview-content-split {
                display: block !important;
                grid-template-columns: none !important;
                gap: 20px;
            }
            
            .preview-image-large {
                max-width: 300px !important;
                width: 90%;
                margin: 0 auto 20px auto;
                display: block;
            }
            
            .preview-aliexpress-logo {
                text-align: left !important;
            }
            
            .preview-aliexpress-logo img {
                width: 200px;
                height: 48px;
            }
            
            .preview-card-title {
                text-align: left !important;
                font-size: 18px !important;
                line-height: 1.3;
            }
            
            .preview-price-main {
                font-size: 28px !important;
                padding: 12px 20px !important;
                margin-bottom: 15px !important;
            }
            
            .preview-rating {
                font-size: 16px !important;
                flex-direction: column;
                align-items: flex-start !important;
                gap: 5px !important;
            }
            
            .preview-sales {
                font-size: 16px !important;
            }
            
            /* üì± Î™®Î∞îÏùº Ìèº ÏµúÏ†ÅÌôî */
            .url-input-group {
                flex-direction: column;
                gap: 10px;
            }
            
            .form-row.two-col,
            .form-row.three-col {
                grid-template-columns: 1fr;
            }
            
            .html-source-header {
                flex-direction: column;
                gap: 10px;
                align-items: stretch;
            }
            
            .html-code {
                font-size: 11px;
                max-height: 200px;
            }
        }
        
        /* üì± Ï∂îÍ∞Ä Î™®Î∞îÏùº ÏµúÏ†ÅÌôî (480px Ïù¥Ìïò) */
        @media (max-width: 480px) {
            .header-section {
                padding: 15px;
            }
            
            .header-section h1 {
                font-size: 20px;
            }
            
            .detail-panel {
                padding: 15px;
            }
            
            .product-image-large img {
                max-width: 280px !important;
            }
            
            .aliexpress-logo-right img {
                width: 180px;
                height: 43px;
            }
            
            .product-title-right {
                font-size: 16px !important;
            }
            
            .product-price-right {
                font-size: 24px !important;
                padding: 10px 15px !important;
            }
        }
    </style>
</head>
<body>
    <div class="main-container">
        <!-- Ìó§Îçî ÏÑπÏÖò -->
        <div class="header-section">
            <h1>üõçÔ∏è Ïñ¥ÌïÑÎ¶¨ÏóêÏù¥Ìä∏ ÏÉÅÌíà Îì±Î°ù</h1>
            <p class="subtitle">ÏïåÎ¶¨ÏùµÏä§ÌîÑÎ†àÏä§ Ï†ÑÏö© ÏÉÅÌíà Í∏Ä ÏÉùÏÑ±Í∏∞</p>
            
            <?php if (!empty($success_message)): ?>
                <div class="alert alert-success"><?php echo esc_html($success_message); ?></div>
            <?php endif; ?>
            
            <?php if (!empty($error_message)): ?>
                <div class="alert alert-error"><?php echo esc_html($error_message); ?></div>
            <?php endif; ?>
            
            <form method="POST" action="keyword_processor.php" id="affiliateForm">
                <div class="header-form">
                    <div class="title-section">
                        <label for="title" style="color: rgba(255,255,255,0.9); margin-bottom: 8px; display: block;">Í∏Ä Ï†úÎ™©</label>
                        <div class="title-input-row">
                            <input type="text" id="title" name="title" placeholder="Í∏Ä Ï†úÎ™©ÏùÑ ÏûÖÎ†•ÌïòÍ±∞ÎÇò ÏïÑÎûò 'Ï†úÎ™© ÏÉùÏÑ±' Î≤ÑÌäºÏùÑ ÌÅ¥Î¶≠ÌïòÏÑ∏Ïöî" required>
                            <button type="button" class="btn btn-secondary" onclick="toggleTitleGenerator()">Ï†úÎ™© ÏÉùÏÑ±</button>
                        </div>
                        
                        <div class="keyword-generator" id="titleGenerator">
                            <label for="titleKeyword" style="color: rgba(255,255,255,0.9);">Ï†úÎ™© ÏÉùÏÑ± ÌÇ§ÏõåÎìú (ÏΩ§ÎßàÎ°ú Íµ¨Î∂Ñ)</label>
                            <div class="keyword-input-row">
                                <input type="text" id="titleKeyword" placeholder="Ïòà: Î¨ºÎÜÄÏù¥Ïö©Ìíà, ÎπÑÏπòÏõ®Ïñ¥, Ïó¨Î¶ÑÏö©Ìíà">
                                <button type="button" class="btn btn-primary" onclick="generateTitles()">ÏÉùÏÑ±</button>
                            </div>
                            
                            <div class="loading" id="titleLoading">
                                <div class="spinner"></div>
                                Ï†úÎ™©ÏùÑ ÏÉùÏÑ±ÌïòÍ≥† ÏûàÏäµÎãàÎã§...
                            </div>
                            
                            <div class="generated-titles" id="generatedTitles" style="display:none;">
                                <label style="color: rgba(255,255,255,0.9);">Ï∂îÏ≤ú Ï†úÎ™© (ÌÅ¥Î¶≠ÌïòÏó¨ ÏÑ†ÌÉù)</label>
                                <div class="title-options" id="titleOptions"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="category-section">
                        <label for="category" style="color: rgba(255,255,255,0.9); margin-bottom: 8px; display: block;">Ïπ¥ÌÖåÍ≥†Î¶¨</label>
                        <select id="category" name="category" required>
                            <option value="356" selected>Ïä§ÎßàÌä∏ Î¶¨Îπô</option>
                            <option value="355">Í∏∞Î∞úÌïú Ïû°ÌôîÏ†ê</option>
                            <option value="354">Today's Pick</option>
                            <option value="12">Ïö∞Î¶¨ÏûáÌÖú</option>
                        </select>
                    </div>
                </div>
            </form>
        </div>
        
        <!-- Î©îÏù∏ ÏΩòÌÖêÏ∏† -->
        <div class="main-content">
            <!-- ÏÉÅÌíà Î™©Î°ù ÏÇ¨Ïù¥ÎìúÎ∞î -->
            <div class="products-sidebar">
                <div class="sidebar-header">
                    <div class="progress-info">
                        <span class="progress-text">ÏßÑÌñâÎ•†</span>
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressFill"></div>
                        </div>
                        <span class="progress-text" id="progressText">0/0 ÏôÑÏÑ±</span>
                    </div>
                </div>
                
                <div class="sidebar-actions">
                    <!-- üî• Í∞úÏÑ†Îêú ÌÇ§ÏõåÎìú Ï∂îÍ∞Ä Î≤ÑÌäº -->
                    <button type="button" class="btn btn-primary" onclick="toggleKeywordInput()" style="width: 100%; margin-bottom: 10px;">üìÅ ÌÇ§ÏõåÎìú Ï∂îÍ∞Ä</button>
                    
                    <!-- üî• ÏÉàÎ°ú Ï∂îÍ∞Ä: Ïù∏ÎùºÏù∏ ÌÇ§ÏõåÎìú ÏûÖÎ†•Ï∞Ω -->
                    <div class="keyword-input-section" id="keywordInputSection">
                        <div class="keyword-input-row-inline">
                            <input type="text" id="newKeywordInput" placeholder="ÏÉà ÌÇ§ÏõåÎìúÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî" />
                            <button type="button" class="btn-success" onclick="addKeywordFromInput()">Ï∂îÍ∞Ä</button>
                            <button type="button" class="btn-secondary" onclick="cancelKeywordInput()">Ï∑®ÏÜå</button>
                        </div>
                    </div>
                    
                    <button type="button" class="btn btn-success" onclick="saveAll()" style="width: 100%;">üíæ Ï†ÑÏ≤¥ Ï†ÄÏû•</button>
                </div>
                
                <div class="products-list" id="productsList">
                    <div class="empty-state">
                        <h3>üì¶ ÏÉÅÌíàÏù¥ ÏóÜÏäµÎãàÎã§</h3>
                        <p>ÏúÑÏùò "ÌÇ§ÏõåÎìú Ï∂îÍ∞Ä" Î≤ÑÌäºÏùÑ ÌÅ¥Î¶≠ÌïòÏó¨<br>Ï≤´ Î≤àÏß∏ ÌÇ§ÏõåÎìúÎ•º Ï∂îÍ∞ÄÌï¥Î≥¥ÏÑ∏Ïöî!</p>
                    </div>
                </div>
            </div>
            
            <!-- ÏÉÅÏÑ∏ Ìé∏Ïßë Ìå®ÎÑê -->
            <div class="detail-panel">
                <div class="detail-header">
                    <h2 id="currentProductTitle">ÏÉÅÌíàÏùÑ ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî</h2>
                    <p id="currentProductSubtitle">ÏôºÏ™Ω Î™©Î°ùÏóêÏÑú ÏÉÅÌíàÏùÑ ÌÅ¥Î¶≠ÌïòÏó¨ Ìé∏ÏßëÏùÑ ÏãúÏûëÌïòÏÑ∏Ïöî.</p>
                </div>
                
                <div id="productDetailContent" style="display: none;">
                    <!-- ÏÉÅÌíà URL ÏûÖÎ†• ÏÑπÏÖò -->
                    <div class="product-url-section">
                        <h3>üåè ÏïåÎ¶¨ÏùµÏä§ÌîÑÎ†àÏä§ ÏÉÅÌíà URL</h3>
                        <div class="url-input-group">
                            <input type="url" id="productUrl" placeholder="Ïòà: https://www.aliexpress.com/item/123456789.html">
                            <button type="button" class="btn btn-primary" onclick="analyzeProduct()">üîç Î∂ÑÏÑù</button>
                        </div>
                        
                        <!-- Ïù∏ÎùºÏù∏ Î∂ÑÏÑù Í≤∞Í≥º -->
                        <div class="analysis-result" id="analysisResult">
                            <div class="product-card" id="productCard">
                                <!-- Î∂ÑÏÑù Í≤∞Í≥ºÍ∞Ä Ïó¨Í∏∞Ïóê ÌëúÏãúÎê©ÎãàÎã§ -->
                            </div>
                            
                            <!-- HTML ÏÜåÏä§ ÏÉùÏÑ± ÏÑπÏÖò -->
                            <div class="html-source-section" id="htmlSourceSection" style="display: none;">
                                <div class="html-source-header">
                                    <h4>üìù ÏõåÎìúÌîÑÎ†àÏä§ Í∏Ä HTML ÏÜåÏä§</h4>
                                    <button type="button" class="copy-btn" onclick="copyHtmlSource()">üìã Î≥µÏÇ¨ÌïòÍ∏∞</button>
                                </div>
                                
                                <div class="html-preview">
                                    <h5 style="margin: 0 0 10px 0; color: #666;">ÎØ∏Î¶¨Î≥¥Í∏∞:</h5>
                                    <div id="htmlPreview">
                                        <!-- HTML ÎØ∏Î¶¨Î≥¥Í∏∞Í∞Ä Ïó¨Í∏∞Ïóê ÌëúÏãúÎê©ÎãàÎã§ -->
                                    </div>
                                </div>
                                
                                <div class="html-code" id="htmlCode">
                                    <!-- HTML ÏÜåÏä§ ÏΩîÎìúÍ∞Ä Ïó¨Í∏∞Ïóê ÌëúÏãúÎê©ÎãàÎã§ -->
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ÏÇ¨Ïö©Ïûê ÏûÖÎ†• ÏñëÏãù (Í∏∞Ï°¥Í≥º ÎèôÏùº) -->
                    <div class="user-input-section">
                        <!-- Í∏∞Îä• Î∞è Ïä§Ìéô -->
                        <div class="input-group">
                            <h3>‚öôÔ∏è Í∏∞Îä• Î∞è Ïä§Ìéô</h3>
                            <div class="form-row">
                                <div class="form-field">
                                    <label>Ï£ºÏöî Í∏∞Îä•</label>
                                    <input type="text" placeholder="Ïòà: ÏûêÎèô ÏïïÏ∂ï, Î¨º Ï†àÏïΩ, ÏãúÍ∞Ñ Îã®Ï∂ï Îì±">
                                </div>
                            </div>
                            <div class="form-row two-col">
                                <div class="form-field">
                                    <label>ÌÅ¨Í∏∞/Ïö©Îüâ</label>
                                    <input type="text" placeholder="Ïòà: 30cm √ó 20cm, 500ml Îì±">
                                </div>
                                <div class="form-field">
                                    <label>ÏÉâÏÉÅ</label>
                                    <input type="text" placeholder="Ïòà: ÌôîÏù¥Ìä∏, Î∏îÎûô, Ïã§Î≤Ñ Îì±">
                                </div>
                            </div>
                            <div class="form-row two-col">
                                <div class="form-field">
                                    <label>Ïû¨Ïßà/ÏÜåÏû¨</label>
                                    <input type="text" placeholder="Ïòà: Ïä§ÌÖåÏù∏Î¶¨Ïä§ Ïä§Ìã∏, Ïã§Î¶¨ÏΩò Îì±">
                                </div>
                                <div class="form-field">
                                    <label>Ï†ÑÏõê/Î∞∞ÌÑ∞Î¶¨</label>
                                    <input type="text" placeholder="Ïòà: USB Ï∂©Ï†Ñ, Í±¥Ï†ÑÏßÄ Îì±">
                                </div>
                            </div>
                        </div>
                        
                        <!-- Ìö®Ïú®ÏÑ± Î∂ÑÏÑù -->
                        <div class="input-group">
                            <h3>üìä Ìö®Ïú®ÏÑ± Î∂ÑÏÑù</h3>
                            <div class="form-row">
                                <div class="form-field">
                                    <label>Ìï¥Í≤∞ÌïòÎäî Î¨∏Ï†ú</label>
                                    <input type="text" placeholder="Ïòà: ÏÑ§Í±∞ÏßÄ ÏãúÍ∞Ñ Ïò§Îûò Í±∏Î¶º">
                                </div>
                            </div>
                            <div class="form-row two-col">
                                <div class="form-field">
                                    <label>ÏãúÍ∞Ñ Ï†àÏïΩ Ìö®Í≥º</label>
                                    <input type="text" placeholder="Ïòà: Í∏∞Ï°¥ 10Î∂Ñ ‚Üí 3Î∂ÑÏúºÎ°ú Îã®Ï∂ï">
                                </div>
                                <div class="form-field">
                                    <label>Í≥µÍ∞Ñ ÌôúÏö©</label>
                                    <input type="text" placeholder="Ïòà: 50% Í≥µÍ∞Ñ Ï†àÏïΩ">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-field">
                                    <label>ÎπÑÏö© Ï†àÍ∞ê</label>
                                    <input type="text" placeholder="Ïòà: Ïõî Ï†ÑÍ∏∞Î£å 30% Ï†àÏïΩ">
                                </div>
                            </div>
                        </div>
                        
                        <!-- ÏÇ¨Ïö© ÏãúÎÇòÎ¶¨Ïò§ -->
                        <div class="input-group">
                            <h3>üè† ÏÇ¨Ïö© ÏãúÎÇòÎ¶¨Ïò§</h3>
                            <div class="form-row two-col">
                                <div class="form-field">
                                    <label>Ï£ºÏöî ÏÇ¨Ïö© Ïû•ÏÜå</label>
                                    <input type="text" placeholder="Ïòà: Ï£ºÎ∞©, ÏöïÏã§, Í±∞Ïã§ Îì±">
                                </div>
                                <div class="form-field">
                                    <label>ÏÇ¨Ïö© ÎπàÎèÑ</label>
                                    <input type="text" placeholder="Ïòà: Îß§Ïùº, Ï£º 2-3Ìöå Îì±">
                                </div>
                            </div>
                            <div class="form-row two-col">
                                <div class="form-field">
                                    <label>Ï†ÅÌï©Ìïú ÏÇ¨Ïö©Ïûê</label>
                                    <input type="text" placeholder="Ïòà: 1Ïù∏ Í∞ÄÍµ¨, ÎßûÎ≤åÏù¥ Î∂ÄÎ∂Ä Îì±">
                                </div>
                                <div class="form-field">
                                    <label>ÏÇ¨Ïö©Î≤ï ÏöîÏïΩ</label>
                                    <input type="text" placeholder="Í∞ÑÎã®Ìïú ÏÇ¨Ïö© Îã®Í≥Ñ">
                                </div>
                            </div>
                        </div>
                        
                        <!-- Ïû•Ï†ê Î∞è Ï£ºÏùòÏÇ¨Ìï≠ -->
                        <div class="input-group">
                            <h3>‚úÖ Ïû•Ï†ê Î∞è Ï£ºÏùòÏÇ¨Ìï≠</h3>
                            <div class="form-row">
                                <div class="form-field">
                                    <label>ÌïµÏã¨ Ïû•Ï†ê 3Í∞ÄÏßÄ</label>
                                    <ol class="advantages-list">
                                        <li><input type="text" placeholder="Ïòà: ÏÑ§Ïπò Í∞ÑÌé∏Ìï®"></li>
                                        <li><input type="text" placeholder="Ïòà: Ïú†ÏßÄÎπÑ Ï†ÄÎ†¥Ìï®"></li>
                                        <li><input type="text" placeholder="Ïòà: ÎÇ¥Íµ¨ÏÑ± Îõ∞Ïñ¥ÎÇ®"></li>
                                    </ol>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-field">
                                    <label>Ï£ºÏùòÏÇ¨Ìï≠</label>
                                    <textarea placeholder="Ïòà: Î¨ºÍ∏∞ Ï£ºÏùò, Ï†ïÍ∏∞ Ï≤≠ÏÜå ÌïÑÏöî Îì±"></textarea>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò -->
                    <div class="navigation-section">
                        <button type="button" class="btn btn-secondary" onclick="previousProduct()">‚¨ÖÔ∏è Ïù¥Ï†Ñ</button>
                        <button type="button" class="btn btn-success" onclick="saveCurrentProduct()">üíæ Ï†ÄÏû•</button>
                        <button type="button" class="btn btn-secondary" onclick="nextProduct()">Îã§Ïùå ‚û°Ô∏è</button>
                        <button type="button" class="btn btn-primary btn-large" onclick="completeProduct()">‚úÖ ÏôÑÎ£å</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Ï†ÑÏó≠ Î≥ÄÏàò
        let keywords = [];
        let currentKeywordIndex = -1;
        let currentProductIndex = -1;
        let currentProductData = null;
        
        // Ï¥àÍ∏∞Ìôî
        document.addEventListener('DOMContentLoaded', function() {
            updateUI();
        });
        
        // üîß Í∞ÄÍ≤© Í≥µÎ∞± Ï∂îÍ∞Ä Ìï®Ïàò
        function formatPrice(price) {
            if (!price) return price;
            // ‚Ç©ÏôÄ Ïà´Ïûê ÏÇ¨Ïù¥Ïóê Í≥µÎ∞± Ï∂îÍ∞Ä (‚Ç©3,440 ‚Üí ‚Ç© 3,440)
            return price.replace(/‚Ç©(\d)/, '‚Ç© $1');
        }
        
        // üîß Í∞úÏÑ†Îêú Ïò§Î•ò Ï≤òÎ¶¨ Ìï®ÏàòÎì§ (Î≥µÏÇ¨ Í∞ÄÎä•Ìïú ÌÅ∞ ÌåùÏóÖ)
        function showDetailedError(title, message, debugData = null) {
            // Í∏∞Ï°¥ Ïò§Î•ò Î™®Îã¨Ïù¥ ÏûàÏúºÎ©¥ Ï†úÍ±∞
            const existingModal = document.getElementById('errorModal');
            if (existingModal) {
                existingModal.remove();
            }
            
            // ÏÉÅÏÑ∏ Ï†ïÎ≥¥ Ìè¨Ìï®
            let fullMessage = message;
            if (debugData) {
                fullMessage += '\n\n=== ÎîîÎ≤ÑÍ∑∏ Ï†ïÎ≥¥ ===\n';
                fullMessage += JSON.stringify(debugData, null, 2);
            }
            
            // ÌÅ∞ Î™®Îã¨ Ï∞Ω ÏÉùÏÑ±
            const modal = document.createElement('div');
            modal.id = 'errorModal';
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.7);
                z-index: 10000;
                display: flex;
                align-items: center;
                justify-content: center;
            `;
            
            modal.innerHTML = `
                <div style="
                    background: white;
                    border-radius: 10px;
                    padding: 30px;
                    max-width: 800px;
                    max-height: 80vh;
                    overflow-y: auto;
                    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                ">
                    <h2 style="color: #dc3545; margin-bottom: 20px; font-size: 24px;">
                        üö® ${title}
                    </h2>
                    
                    <div style="margin-bottom: 20px;">
                        <textarea id="errorContent" readonly style="
                            width: 100%;
                            height: 300px;
                            padding: 15px;
                            border: 1px solid #ddd;
                            border-radius: 6px;
                            font-family: 'Courier New', monospace;
                            font-size: 12px;
                            line-height: 1.4;
                            background: #f8f9fa;
                            resize: vertical;
                        ">${fullMessage}</textarea>
                    </div>
                    
                    <div style="display: flex; gap: 10px; justify-content: flex-end;">
                        <button onclick="copyErrorToClipboard()" style="
                            padding: 10px 20px;
                            background: #007bff;
                            color: white;
                            border: none;
                            border-radius: 6px;
                            cursor: pointer;
                            font-size: 14px;
                        ">üìã Î≥µÏÇ¨ÌïòÍ∏∞</button>
                        
                        <button onclick="closeErrorModal()" style="
                            padding: 10px 20px;
                            background: #6c757d;
                            color: white;
                            border: none;
                            border-radius: 6px;
                            cursor: pointer;
                            font-size: 14px;
                        ">Îã´Í∏∞</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Î™®Îã¨ Ïô∏Î∂Ä ÌÅ¥Î¶≠Ïãú Îã´Í∏∞
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    closeErrorModal();
                }
            });
        }

        // Ïò§Î•ò ÎÇ¥Ïö© ÌÅ¥Î¶ΩÎ≥¥Îìú Î≥µÏÇ¨
        function copyErrorToClipboard() {
            const errorContent = document.getElementById('errorContent');
            errorContent.select();
            document.execCommand('copy');
            
            // Î≥µÏÇ¨ ÏôÑÎ£å ÏïåÎ¶º
            const copyBtn = event.target;
            const originalText = copyBtn.textContent;
            copyBtn.textContent = '‚úÖ Î≥µÏÇ¨Îê®!';
            copyBtn.style.background = '#28a745';
            
            setTimeout(() => {
                copyBtn.textContent = originalText;
                copyBtn.style.background = '#007bff';
            }, 2000);
        }

        // Ïò§Î•ò Î™®Îã¨ Îã´Í∏∞
        function closeErrorModal() {
            const modal = document.getElementById('errorModal');
            if (modal) {
                modal.remove();
            }
        }

        // ESC ÌÇ§Î°ú Î™®Îã¨ Îã´Í∏∞
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeErrorModal();
            }
        });
        
        // Ï†úÎ™© ÏÉùÏÑ±Í∏∞ ÌÜ†Í∏Ä
        function toggleTitleGenerator() {
            const generator = document.getElementById('titleGenerator');
            generator.style.display = generator.style.display === 'none' ? 'block' : 'none';
        }
        
        // Ï†úÎ™© ÏÉùÏÑ±
        async function generateTitles() {
            const keywordsInput = document.getElementById('titleKeyword').value.trim();
            
            if (!keywordsInput) {
                showDetailedError('ÏûÖÎ†• Ïò§Î•ò', 'ÌÇ§ÏõåÎìúÎ•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }
            
            const loading = document.getElementById('titleLoading');
            const titlesDiv = document.getElementById('generatedTitles');
            
            loading.style.display = 'block';
            titlesDiv.style.display = 'none';
            
            try {
                const formData = new FormData();
                formData.append('action', 'generate_titles');
                formData.append('keywords', keywordsInput);
                
                const response = await fetch('', {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                if (result.success) {
                    displayTitles(result.titles);
                } else {
                    showDetailedError('Ï†úÎ™© ÏÉùÏÑ± Ïã§Ìå®', result.message);
                }
            } catch (error) {
                showDetailedError('Ï†úÎ™© ÏÉùÏÑ± Ïò§Î•ò', 'Ï†úÎ™© ÏÉùÏÑ± Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.', {
                    'error': error.message,
                    'keywords': keywordsInput
                });
            } finally {
                loading.style.display = 'none';
            }
        }
        
        // ÏÉùÏÑ±Îêú Ï†úÎ™© ÌëúÏãú
        function displayTitles(titles) {
            const optionsDiv = document.getElementById('titleOptions');
            const titlesDiv = document.getElementById('generatedTitles');
            
            optionsDiv.innerHTML = '';
            
            titles.forEach((title) => {
                const button = document.createElement('button');
                button.type = 'button';
                button.className = 'title-option';
                button.textContent = title;
                button.onclick = () => selectTitle(title);
                optionsDiv.appendChild(button);
            });
            
            titlesDiv.style.display = 'block';
        }
        
        // Ï†úÎ™© ÏÑ†ÌÉù
        function selectTitle(title) {
            document.getElementById('title').value = title;
            document.getElementById('titleGenerator').style.display = 'none';
        }
        
        // üî• ÏÉàÎ°ú Ï∂îÍ∞Ä: Ïù∏ÎùºÏù∏ ÌÇ§ÏõåÎìú ÏûÖÎ†•Ï∞Ω ÌÜ†Í∏Ä
        function toggleKeywordInput() {
            const inputSection = document.getElementById('keywordInputSection');
            const isVisible = inputSection.classList.contains('show');
            
            if (isVisible) {
                inputSection.classList.remove('show');
            } else {
                inputSection.classList.add('show');
                document.getElementById('newKeywordInput').focus();
            }
        }
        
        // üî• ÏÉàÎ°ú Ï∂îÍ∞Ä: ÏûÖÎ†•Ï∞ΩÏóêÏÑú ÌÇ§ÏõåÎìú Ï∂îÍ∞Ä
        function addKeywordFromInput() {
            const input = document.getElementById('newKeywordInput');
            const name = input.value.trim();
            
            if (name) {
                const keyword = {
                    name: name,
                    products: []
                };
                keywords.push(keyword);
                updateUI();
                
                // ÏûÖÎ†•Ï∞Ω Ï¥àÍ∏∞Ìôî Î∞è Ïà®Í∏∞Í∏∞
                input.value = '';
                document.getElementById('keywordInputSection').classList.remove('show');
                
                // ÏÉàÎ°ú Ï∂îÍ∞ÄÎêú ÌÇ§ÏõåÎìúÏóê Ï≤´ Î≤àÏß∏ ÏÉÅÌíà Ï∂îÍ∞Ä
                addProduct(keywords.length - 1);
            } else {
                showDetailedError('ÏûÖÎ†• Ïò§Î•ò', 'ÌÇ§ÏõåÎìúÎ•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
            }
        }
        
        // üî• ÏÉàÎ°ú Ï∂îÍ∞Ä: ÌÇ§ÏõåÎìú ÏûÖÎ†• Ï∑®ÏÜå
        function cancelKeywordInput() {
            const input = document.getElementById('newKeywordInput');
            input.value = '';
            document.getElementById('keywordInputSection').classList.remove('show');
        }
        
        // üî• ÏÉàÎ°ú Ï∂îÍ∞Ä: ÏóîÌÑ∞ÌÇ§Î°ú ÌÇ§ÏõåÎìú Ï∂îÍ∞Ä
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('newKeywordInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    addKeywordFromInput();
                }
            });
        });
        
        // Í∏∞Ï°¥ ÌÇ§ÏõåÎìú Ï∂îÍ∞Ä Ìï®Ïàò (Ìè¥Î∞±Ïö©)
        function addKeyword() {
            // Ïù∏ÎùºÏù∏ ÏûÖÎ†•Ï∞ΩÏúºÎ°ú ÎåÄÏ≤¥Îê®
            toggleKeywordInput();
        }
        
        // ÏÉÅÌíà Ï∂îÍ∞Ä
        function addProduct(keywordIndex) {
            const product = {
                id: Date.now() + Math.random(),
                url: '',
                name: `ÏÉÅÌíà ${keywords[keywordIndex].products.length + 1}`,
                status: 'empty',
                analysisData: null,
                userData: {}
            };
            
            keywords[keywordIndex].products.push(product);
            updateUI();
            
            // ÏÉàÎ°ú Ï∂îÍ∞ÄÎêú ÏÉÅÌíà ÏÑ†ÌÉù
            selectProduct(keywordIndex, keywords[keywordIndex].products.length - 1);
        }
        
        // ÏÉÅÌíà ÏÑ†ÌÉù
        function selectProduct(keywordIndex, productIndex) {
            currentKeywordIndex = keywordIndex;
            currentProductIndex = productIndex;
            
            const product = keywords[keywordIndex].products[productIndex];
            
            // ÏÉÅÌíà ÏÑ†ÌÉù ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
            document.querySelectorAll('.product-item').forEach(item => {
                item.classList.remove('active');
            });
            
            const selectedItem = document.querySelector(`[data-keyword="${keywordIndex}"][data-product="${productIndex}"]`);
            if (selectedItem) {
                selectedItem.classList.add('active');
            }
            
            // ÏÉÅÏÑ∏ Ìå®ÎÑê ÏóÖÎç∞Ïù¥Ìä∏
            updateDetailPanel(product);
        }
        
        // ÏÉÅÏÑ∏ Ìå®ÎÑê ÏóÖÎç∞Ïù¥Ìä∏
        function updateDetailPanel(product) {
            const titleEl = document.getElementById('currentProductTitle');
            const subtitleEl = document.getElementById('currentProductSubtitle');
            const contentEl = document.getElementById('productDetailContent');
            const urlInput = document.getElementById('productUrl');
            
            titleEl.textContent = product.name;
            subtitleEl.textContent = `ÌÇ§ÏõåÎìú: ${keywords[currentKeywordIndex].name}`;
            
            urlInput.value = product.url || '';
            
            // Î∂ÑÏÑù Í≤∞Í≥º ÌëúÏãú
            if (product.analysisData) {
                showAnalysisResult(product.analysisData);
            } else {
                hideAnalysisResult();
            }
            
            contentEl.style.display = 'block';
        }
        
        // üîß Í∞úÏÑ†Îêú ÏÉÅÌíà Î∂ÑÏÑù (AliExpress Ï¢åÏö∞Î∂ÑÌï† Ïä§ÌÉÄÏùº)
        async function analyzeProduct() {
            const url = document.getElementById('productUrl').value.trim();
            
            if (!url) {
                showDetailedError('ÏûÖÎ†• Ïò§Î•ò', 'ÏÉÅÌíà URLÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }
            
            if (currentKeywordIndex === -1 || currentProductIndex === -1) {
                showDetailedError('ÏÑ†ÌÉù Ïò§Î•ò', 'ÏÉÅÌíàÏùÑ Î®ºÏ†Ä ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }
            
            const product = keywords[currentKeywordIndex].products[currentProductIndex];
            product.url = url;
            product.status = 'analyzing';
            updateUI();
            
            try {
                console.log('üöÄ AliExpress Ï¢åÏö∞Î∂ÑÌï† Ïä§ÌÉÄÏùº API Ìò∏Ï∂ú ÏãúÏûë');
                
                const response = await fetch('product_analyzer_v2.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'analyze_product',
                        url: url,
                        platform: 'aliexpress'
                    })
                });
                
                // üîß ÏùëÎãµ ÏÉÅÌÉú ÌôïÏù∏ Í∞ïÌôî
                if (!response.ok) {
                    throw new Error(`HTTP Ïò§Î•ò: ${response.status} ${response.statusText}`);
                }
                
                const responseText = await response.text();
                console.log('üì® ÏõêÎ≥∏ ÏùëÎãµ:', responseText);
                
                let result;
                try {
                    result = JSON.parse(responseText);
                } catch (parseError) {
                    // üîß JSON ÌååÏã± Ïã§Ìå® Ïãú ÏÉÅÏÑ∏ Ïò§Î•ò ÌëúÏãú
                    showDetailedError(
                        'JSON ÌååÏã± Ïò§Î•ò', 
                        'ÏÑúÎ≤Ñ ÏùëÎãµÏùÑ ÌååÏã±Ìï† Ïàò ÏóÜÏäµÎãàÎã§.',
                        {
                            'parseError': parseError.message,
                            'responseText': responseText,
                            'responseLength': responseText.length,
                            'url': url,
                            'timestamp': new Date().toISOString()
                        }
                    );
                    product.status = 'error';
                    updateUI();
                    return;
                }
                
                console.log('üìä ÌååÏã±Îêú Í≤∞Í≥º:', result);
                
                if (result.success) {
                    product.analysisData = result.data;
                    product.status = 'completed';
                    product.name = result.data.title || `ÏÉÅÌíà ${currentProductIndex + 1}`;
                    currentProductData = result.data;
                    
                    showAnalysisResult(result.data);
                    generateResponsiveAliExpressHtml(result.data);
                    
                    // üé® ÏÑ±Í≥µ Î°úÍ∑∏ (AliExpress Ï¢åÏö∞Î∂ÑÌï† Ïä§ÌÉÄÏùº)
                    console.log('‚úÖ AliExpress Ï¢åÏö∞Î∂ÑÌï† Ïä§ÌÉÄÏùº Î∂ÑÏÑù ÏÑ±Í≥µ:');
                    console.log('  ÌïúÍµ≠Ïñ¥ ÏÉÅÌíàÎ™Ö:', result.data.title || 'N/A');
                    console.log('  ÌèâÏ†ê ÌëúÏãú:', result.data.rating_display || 'N/A');
                    console.log('  ÌåêÎß§Îüâ:', result.data.lastest_volume || 'N/A');
                    console.log('  Ï†ÑÏ≤¥ Îç∞Ïù¥ÌÑ∞:', result.data);
                    
                } else {
                    product.status = 'error';
                    
                    // üîß ÏÉÅÏÑ∏Ìïú Ïò§Î•ò Ï†ïÎ≥¥ ÌëúÏãú (Í∞úÏÑ†Îêú Î™®Îã¨ ÏÇ¨Ïö©)
                    showDetailedError(
                        'ÏÉÅÌíà Î∂ÑÏÑù Ïã§Ìå®',
                        result.message || 'Ïïå Ïàò ÏóÜÎäî Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.',
                        {
                            'success': result.success,
                            'message': result.message,
                            'debug_info': result.debug_info || null,
                            'raw_output': result.raw_output || null,
                            'url': url,
                            'platform': 'aliexpress',
                            'timestamp': new Date().toISOString(),
                            'responsive_style_applied': true
                        }
                    );
                    
                    console.error('‚ùå Î∂ÑÏÑù Ïã§Ìå®:', result);
                }
                
            } catch (error) {
                product.status = 'error';
                
                // üîß ÎÑ§Ìä∏ÏõåÌÅ¨ Ïò§Î•ò ÏÉÅÏÑ∏ ÌëúÏãú
                showDetailedError(
                    'ÎÑ§Ìä∏ÏõåÌÅ¨ Ïò§Î•ò',
                    'ÏÉÅÌíà Î∂ÑÏÑù Ï§ë ÎÑ§Ìä∏ÏõåÌÅ¨ Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.',
                    {
                        'error': error.message,
                        'stack': error.stack,
                        'url': url,
                        'timestamp': new Date().toISOString()
                    }
                );
                
                console.error('‚ùå ÎÑ§Ìä∏ÏõåÌÅ¨ Ïò§Î•ò:', error);
            }
            
            updateUI();
        }
        
        // üé® AliExpress Ï¢åÏö∞Î∂ÑÌï† Ïä§ÌÉÄÏùº Î∂ÑÏÑù Í≤∞Í≥º ÌëúÏãú
        function showAnalysisResult(data) {
            const resultEl = document.getElementById('analysisResult');
            const cardEl = document.getElementById('productCard');
            
            // ÌèâÏ†ê Ï≤òÎ¶¨ (Í≥†Í∞ùÎßåÏ°±ÎèÑ ÌòïÌÉú) - Ï§ëÎ≥µ Í¥ÑÌò∏ Ï†úÍ±∞
            const ratingDisplay = data.rating_display ? data.rating_display.replace(/‚≠ê/g, '').replace(/[()]/g, '').trim() : 'Ï†ïÎ≥¥ ÏóÜÏùå';
            
            // üîß Í∞ÄÍ≤© Í≥µÎ∞± Ï∂îÍ∞Ä Ï≤òÎ¶¨
            const formattedPrice = formatPrice(data.price);
            
            // AliExpress Ï¢åÏö∞Î∂ÑÌï† Ïä§ÌÉÄÏùº Ïπ¥Îìú ÎîîÏûêÏù∏ - Î∂ÑÏÑùÌôîÎ©¥ Î∏îÎ°ù (400px Ïù¥ÎØ∏ÏßÄ)
            cardEl.innerHTML = `
                <!-- Ï¢åÏö∞ Î∂ÑÌï† Î†àÏù¥ÏïÑÏõÉ (Ïù¥ÎØ∏ÏßÄ 400px, Ï†ïÎ≥¥ ÏòÅÏó≠ ÌôïÎåÄ) -->
                <div class="product-content-split">
                    <!-- ÏôºÏ™Ω: Ïù¥ÎØ∏ÏßÄ (400pxÎ°ú Ï°∞Ï†ï) -->
                    <div class="product-image-large">
                        <img src="${data.image_url}" alt="${data.title}" onerror="this.style.display='none'">
                    </div>
                    
                    <!-- Ïò§Î•∏Ï™Ω: Î™®Îì† Ï†ïÎ≥¥ (Îçî ÎÑìÏñ¥ÏßÑ ÏòÅÏó≠) -->
                    <div class="product-info-all">
                        <!-- AliExpress Î°úÍ≥† -->
                        <div class="aliexpress-logo-right">
                            <img src="https://novacents.com/tools/images/Ali_black_logo.webp" alt="AliExpress" />
                        </div>
                        
                        <!-- ÏÉÅÌíàÎ™Ö -->
                        <h3 class="product-title-right">${data.title}</h3>
                        
                        <!-- Í∞ÄÍ≤© (ÏßÄÏ†ïÎêú Î∞∞Í≤ΩÏÉâ) -->
                        <div class="product-price-right">
                            ${formattedPrice}
                        </div>
                        
                        <!-- ÌèâÏ†ê (Í≥†Í∞ùÎßåÏ°±ÎèÑ ÌòïÌÉú) -->
                        <div class="product-rating-right">
                            <span class="rating-stars">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</span>
                            <span>(Í≥†Í∞ùÎßåÏ°±ÎèÑ: ${ratingDisplay})</span>
                        </div>
                        
                        <!-- ÌåêÎß§Îüâ -->
                        <div class="product-sales-right">
                            <strong>üì¶ ÌåêÎß§Îüâ:</strong> ${data.lastest_volume || 'ÌåêÎß§Îüâ Ï†ïÎ≥¥ ÏóÜÏùå'}
                        </div>
                        
                        <!-- Í∏∞ÌÉÄ Ï†ïÎ≥¥ -->
                        <div class="product-extra-info-right">
                            <div class="info-row">
                                <span class="info-label">ÏÉÅÌíà ID</span>
                                <span class="info-value">${data.product_id}</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">ÌîåÎû´Ìèº</span>
                                <span class="info-value">${data.platform}</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Íµ¨Îß§ Î≤ÑÌäº (ÌïòÎã® Ï†ÑÏ≤¥ Ìè≠) -->
                <div class="purchase-button-full">
                    <a href="${data.affiliate_link}" target="_blank" rel="nofollow">
                        <picture>
                            <source media="(max-width: 768px)" srcset="https://novacents.com/tools/images/aliexpress-button-mobile.png">
                            <img src="https://novacents.com/tools/images/aliexpress-button-pc.png" 
                                 alt="ÏïåÎ¶¨ÏùµÏä§ÌîÑÎ†àÏä§ÏóêÏÑú Íµ¨Îß§ÌïòÍ∏∞">
                        </picture>
                    </a>
                </div>
            `;
            
            resultEl.classList.add('show');
        }
        
        // üì± Î∞òÏùëÌòï AliExpress HTML ÏÜåÏä§ ÏÉùÏÑ± Ìï®Ïàò (Î™®Î∞îÏùº ÏµúÏ†ÅÌôî)
        function generateResponsiveAliExpressHtml(data) {
            if (!data) return;
            
            console.log('üì± Î∞òÏùëÌòï AliExpress HTML ÏÜåÏä§ ÏÉùÏÑ± ÏãúÏûë');
            
            // ÌèâÏ†ê Ï≤òÎ¶¨ (Í≥†Í∞ùÎßåÏ°±ÎèÑ ÌòïÌÉú) - Ï§ëÎ≥µ Í¥ÑÌò∏ Ï†úÍ±∞
            const ratingDisplay = data.rating_display ? data.rating_display.replace(/‚≠ê/g, '').replace(/[()]/g, '').trim() : 'Ï†ïÎ≥¥ ÏóÜÏùå';
            
            // üîß Í∞ÄÍ≤© Í≥µÎ∞± Ï∂îÍ∞Ä Ï≤òÎ¶¨
            const formattedPrice = formatPrice(data.price);
            
            // üì± ÏôÑÏ†Ñ Î∞òÏùëÌòï AliExpress HTML ÏΩîÎìú ÏÉùÏÑ± (Î™®Î∞îÏùº Ï¢åÏ∏°Ï†ïÎ†¨)
            const htmlCode = `<div style="display: flex; justify-content: center; margin: 25px 0;">
    <div style="border: 2px solid #eee; padding: 30px; border-radius: 15px; background: #f9f9f9; box-shadow: 0 4px 8px rgba(0,0,0,0.1); max-width: 1000px; width: 100%;">
        
        <!-- üì± Î∞òÏùëÌòï Ï¢åÏö∞ Î∂ÑÌï† Î†àÏù¥ÏïÑÏõÉ -->
        <div style="display: grid; grid-template-columns: 400px 1fr; gap: 30px; align-items: start; margin-bottom: 25px;">
            <!-- ÏôºÏ™Ω: Ïù¥ÎØ∏ÏßÄ (PC: 400px, Î™®Î∞îÏùº: 300px) -->
            <div style="text-align: center;">
                <img src="${data.image_url}" alt="${data.title}" style="width: 100%; max-width: 400px; border-radius: 12px; box-shadow: 0 6px 20px rgba(0,0,0,0.15);">
            </div>
            
            <!-- Ïò§Î•∏Ï™Ω: Î™®Îì† Ï†ïÎ≥¥ -->
            <div style="display: flex; flex-direction: column; gap: 20px;">
                <!-- AliExpress Î°úÍ≥† (PC: Ï§ëÏïô, Î™®Î∞îÏùº: Ï¢åÏ∏°) -->
                <div style="margin-bottom: 15px; text-align: center;">
                    <img src="https://novacents.com/tools/images/Ali_black_logo.webp" alt="AliExpress" style="width: 250px; height: 60px; object-fit: contain;" />
                </div>
                
                <!-- ÏÉÅÌíàÎ™Ö (PC: Ï§ëÏïô, Î™®Î∞îÏùº: Ï¢åÏ∏°) -->
                <h3 style="color: #1c1c1c; margin: 0 0 20px 0; font-size: 21px; font-weight: 600; line-height: 1.4; word-break: keep-all; overflow-wrap: break-word; text-align: center;">${data.title}</h3>
                
                <!-- Í∞ÄÍ≤© (ÏßÄÏ†ïÎêú Î∞∞Í≤ΩÏÉâ) -->
                <div style="background: linear-gradient(135deg, #e62e04 0%, #ff9900 100%); color: white; padding: 14px 30px; border-radius: 10px; font-size: 40px; font-weight: 700; text-align: center; margin-bottom: 20px; box-shadow: 0 4px 15px rgba(230, 46, 4, 0.3);">
                    <strong>${formattedPrice}</strong>
                </div>
                
                <!-- ÌèâÏ†ê (Í≥†Í∞ùÎßåÏ°±ÎèÑ ÌòïÌÉú) -->
                <div style="color: #1c1c1c; font-size: 20px; display: flex; align-items: center; gap: 10px; margin-bottom: 15px; justify-content: center;">
                    <span style="color: #ff9900;">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</span>
                    <span>(Í≥†Í∞ùÎßåÏ°±ÎèÑ: ${ratingDisplay})</span>
                </div>
                
                <!-- ÌåêÎß§Îüâ -->
                <p style="color: #1c1c1c; font-size: 18px; margin: 0 0 15px 0; text-align: center;"><strong>üì¶ ÌåêÎß§Îüâ:</strong> ${data.lastest_volume || 'ÌåêÎß§Îüâ Ï†ïÎ≥¥ ÏóÜÏùå'}</p>
            </div>
        </div>
        
        <!-- Íµ¨Îß§ Î≤ÑÌäº (ÌïòÎã® Ï†ÑÏ≤¥ Ìè≠) -->
        <div style="text-align: center; margin-top: 30px; width: 100%;">
            <a href="${data.affiliate_link}" target="_blank" rel="nofollow" style="text-decoration: none;">
                <picture>
                    <source media="(max-width: 768px)" srcset="https://novacents.com/tools/images/aliexpress-button-mobile.png">
                    <img src="https://novacents.com/tools/images/aliexpress-button-pc.png" 
                         alt="ÏïåÎ¶¨ÏùµÏä§ÌîÑÎ†àÏä§ÏóêÏÑú Íµ¨Îß§ÌïòÍ∏∞" 
                         style="max-width: 100%; height: auto; cursor: pointer;">
                </picture>
            </a>
        </div>
    </div>
</div>

<style>
/* üì± Î™®Î∞îÏùº Î∞òÏùëÌòï CSS */
@media (max-width: 768px) {
    /* Ï¢åÏö∞ Î∂ÑÌï†ÏùÑ ÏÑ∏Î°ú Î∞∞ÏπòÎ°ú Î≥ÄÍ≤Ω */
    div[style*="grid-template-columns: 400px 1fr"] {
        display: block !important;
        grid-template-columns: none !important;
    }
    
    /* Î™®Î∞îÏùº Ïù¥ÎØ∏ÏßÄ ÌÅ¨Í∏∞ ÏµúÏ†ÅÌôî */
    img[style*="max-width: 400px"] {
        max-width: 300px !important;
    }
    
    /* Î™®Î∞îÏùº Î°úÍ≥† Ï¢åÏ∏°Ï†ïÎ†¨ */
    div[style*="text-align: center"] img[alt="AliExpress"] {
        display: block;
        margin: 0 !important;
    }
    div[style*="text-align: center"]:has(img[alt="AliExpress"]) {
        text-align: left !important;
    }
    
    /* Î™®Î∞îÏùº ÏÉÅÌíàÎ™Ö Ï¢åÏ∏°Ï†ïÎ†¨ */
    h3[style*="text-align: center"] {
        text-align: left !important;
        font-size: 18px !important;
    }
    
    /* Î™®Î∞îÏùº Í∞ÄÍ≤© ÌÅ¨Í∏∞ Ï°∞Ï†ï */
    div[style*="font-size: 40px"] {
        font-size: 28px !important;
        padding: 12px 20px !important;
    }
    
    /* Î™®Î∞îÏùº ÌèâÏ†ê ÏÑ∏Î°ú Î∞∞Ïπò */
    div[style*="justify-content: center"] {
        flex-direction: column !important;
        align-items: flex-start !important;
        gap: 5px !important;
        justify-content: flex-start !important;
        font-size: 16px !important;
    }
    
    /* Î™®Î∞îÏùº ÌåêÎß§Îüâ Ï¢åÏ∏°Ï†ïÎ†¨ */
    p[style*="text-align: center"] {
        text-align: left !important;
        font-size: 16px !important;
    }
}

@media (max-width: 480px) {
    /* Îçî ÏûëÏùÄ ÌôîÎ©¥ ÏµúÏ†ÅÌôî */
    img[style*="max-width: 300px"] {
        max-width: 280px !important;
    }
    
    h3[style*="font-size: 18px"] {
        font-size: 16px !important;
    }
    
    div[style*="font-size: 28px"] {
        font-size: 24px !important;
    }
}
</style>`;
            
            // üì± Î∞òÏùëÌòï HTML ÎØ∏Î¶¨Î≥¥Í∏∞ ÏÉùÏÑ± (CSS Ìö®Í≥º Ï†ÅÏö©Îê®)
            const previewHtml = `
                <div class="preview-product-card">
                    <div class="preview-card-content">
                        <!-- Ï¢åÏö∞ Î∂ÑÌï† Î†àÏù¥ÏïÑÏõÉ (Î™®Î∞îÏùºÏóêÏÑú ÏÑ∏Î°ú Î∞∞Ïπò) -->
                        <div class="product-content-split">
                            <!-- ÏôºÏ™Ω: Ïù¥ÎØ∏ÏßÄ -->
                            <div class="product-image-large">
                                <img src="${data.image_url}" alt="${data.title}" onerror="this.style.display='none'">
                            </div>
                            
                            <!-- Ïò§Î•∏Ï™Ω: Î™®Îì† Ï†ïÎ≥¥ -->
                            <div class="product-info-all">
                                <!-- AliExpress Î°úÍ≥† -->
                                <div class="aliexpress-logo-right">
                                    <img src="https://novacents.com/tools/images/Ali_black_logo.webp" alt="AliExpress" />
                                </div>
                                
                                <!-- ÏÉÅÌíàÎ™Ö -->
                                <h3 class="product-title-right">${data.title}</h3>
                                
                                <!-- Í∞ÄÍ≤© (ÏßÄÏ†ïÎêú Î∞∞Í≤ΩÏÉâ) -->
                                <div class="product-price-right">
                                    ${formattedPrice}
                                </div>
                                
                                <!-- ÌèâÏ†ê (Í≥†Í∞ùÎßåÏ°±ÎèÑ ÌòïÌÉú) -->
                                <div class="product-rating-right">
                                    <span class="rating-stars">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</span>
                                    <span>(Í≥†Í∞ùÎßåÏ°±ÎèÑ: ${ratingDisplay})</span>
                                </div>
                                
                                <!-- ÌåêÎß§Îüâ -->
                                <div class="product-sales-right">
                                    <strong>üì¶ ÌåêÎß§Îüâ:</strong> ${data.lastest_volume || 'ÌåêÎß§Îüâ Ï†ïÎ≥¥ ÏóÜÏùå'}
                                </div>
                            </div>
                        </div>
                        
                        <!-- Íµ¨Îß§ Î≤ÑÌäº (ÌïòÎã® Ï†ÑÏ≤¥ Ìè≠) -->
                        <div class="purchase-button-full">
                            <a href="${data.affiliate_link}" target="_blank" rel="nofollow">
                                <picture>
                                    <source media="(max-width: 768px)" srcset="https://novacents.com/tools/images/aliexpress-button-mobile.png">
                                    <img src="https://novacents.com/tools/images/aliexpress-button-pc.png" 
                                         alt="ÏïåÎ¶¨ÏùµÏä§ÌîÑÎ†àÏä§ÏóêÏÑú Íµ¨Îß§ÌïòÍ∏∞">
                                </picture>
                            </a>
                        </div>
                    </div>
                </div>
            `;
            
            // DOMÏóê ÌëúÏãú
            document.getElementById('htmlPreview').innerHTML = previewHtml;
            document.getElementById('htmlCode').textContent = htmlCode;
            document.getElementById('htmlSourceSection').style.display = 'block';
            
            console.log('‚úÖ üì± Î∞òÏùëÌòï AliExpress HTML ÏÜåÏä§ ÏÉùÏÑ± ÏôÑÎ£å (Î™®Î∞îÏùº Ï¢åÏ∏°Ï†ïÎ†¨)');
        }
        
        // ÌÅ¥Î¶ΩÎ≥¥Îìú Î≥µÏÇ¨ Ìï®Ïàò
        async function copyHtmlSource() {
            const htmlCode = document.getElementById('htmlCode').textContent;
            const copyBtn = document.querySelector('.copy-btn');
            
            try {
                await navigator.clipboard.writeText(htmlCode);
                
                // Î≤ÑÌäº ÏÉÅÌÉú Î≥ÄÍ≤Ω
                const originalText = copyBtn.textContent;
                copyBtn.textContent = '‚úÖ Î≥µÏÇ¨Îê®!';
                copyBtn.classList.add('copied');
                
                // 2Ï¥à ÌõÑ ÏõêÎûò ÏÉÅÌÉúÎ°ú Î≥µÏõê
                setTimeout(() => {
                    copyBtn.textContent = originalText;
                    copyBtn.classList.remove('copied');
                }, 2000);
                
                console.log('üìã üì± Î∞òÏùëÌòï AliExpress HTML ÏÜåÏä§ ÌÅ¥Î¶ΩÎ≥¥Îìú Î≥µÏÇ¨ ÏôÑÎ£å');
                
            } catch (error) {
                console.error('‚ùå ÌÅ¥Î¶ΩÎ≥¥Îìú Î≥µÏÇ¨ Ïã§Ìå®:', error);
                
                // Ìè¥Î∞±: ÌÖçÏä§Ìä∏ ÏÑ†ÌÉù
                const codeEl = document.getElementById('htmlCode');
                const range = document.createRange();
                range.selectNodeContents(codeEl);
                const selection = window.getSelection();
                selection.removeAllRanges();
                selection.addRange(range);
                
                showDetailedError('Î≥µÏÇ¨ ÏïåÎ¶º', 'HTML ÏÜåÏä§Í∞Ä ÏÑ†ÌÉùÎêòÏóàÏäµÎãàÎã§. Ctrl+CÎ°ú Î≥µÏÇ¨ÌïòÏÑ∏Ïöî.');
            }
        }
        
        // Î∂ÑÏÑù Í≤∞Í≥º Ïà®Í∏∞Í∏∞
        function hideAnalysisResult() {
            const resultEl = document.getElementById('analysisResult');
            resultEl.classList.remove('show');
            
            // HTML ÏÜåÏä§ ÏÑπÏÖòÎèÑ Ïà®Í∏∞Í∏∞
            document.getElementById('htmlSourceSection').style.display = 'none';
        }
        
        // UI ÏóÖÎç∞Ïù¥Ìä∏
        function updateUI() {
            updateProductsList();
            updateProgress();
        }
        
        // ÏÉÅÌíà Î™©Î°ù ÏóÖÎç∞Ïù¥Ìä∏
        function updateProductsList() {
            const listEl = document.getElementById('productsList');
            
            if (keywords.length === 0) {
                listEl.innerHTML = `
                    <div class="empty-state">
                        <h3>üì¶ ÏÉÅÌíàÏù¥ ÏóÜÏäµÎãàÎã§</h3>
                        <p>ÏúÑÏùò "ÌÇ§ÏõåÎìú Ï∂îÍ∞Ä" Î≤ÑÌäºÏùÑ ÌÅ¥Î¶≠ÌïòÏó¨<br>Ï≤´ Î≤àÏß∏ ÌÇ§ÏõåÎìúÎ•º Ï∂îÍ∞ÄÌï¥Î≥¥ÏÑ∏Ïöî!</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            
            keywords.forEach((keyword, keywordIndex) => {
                html += `
                    <div class="keyword-group">
                        <div class="keyword-header">
                            <div class="keyword-info">
                                <span class="keyword-name">üìÅ ${keyword.name}</span>
                                <span class="product-count">${keyword.products.length}Í∞ú</span>
                            </div>
                            <div class="keyword-actions">
                                <button type="button" class="btn btn-success btn-small" onclick="addProduct(${keywordIndex})">+ÏÉÅÌíà</button>
                            </div>
                        </div>
                `;
                
                keyword.products.forEach((product, productIndex) => {
                    const statusIcon = getStatusIcon(product.status);
                    html += `
                        <div class="product-item" data-keyword="${keywordIndex}" data-product="${productIndex}" onclick="selectProduct(${keywordIndex}, ${productIndex})">
                            <span class="product-status">${statusIcon}</span>
                            <span class="product-name">${product.name}</span>
                        </div>
                    `;
                });
                
                html += '</div>';
            });
            
            listEl.innerHTML = html;
        }
        
        // ÏÉÅÌÉú ÏïÑÏù¥ÏΩò Î∞òÌôò
        function getStatusIcon(status) {
            switch (status) {
                case 'completed': return '‚úÖ';
                case 'analyzing': return 'üîÑ';
                case 'error': return '‚ö†Ô∏è';
                default: return '‚ùå';
            }
        }
        
        // ÏßÑÌñâÎ•† ÏóÖÎç∞Ïù¥Ìä∏
        function updateProgress() {
            const totalProducts = keywords.reduce((sum, keyword) => sum + keyword.products.length, 0);
            const completedProducts = keywords.reduce((sum, keyword) => 
                sum + keyword.products.filter(p => p.status === 'completed').length, 0);
            
            const percentage = totalProducts > 0 ? (completedProducts / totalProducts) * 100 : 0;
            
            document.getElementById('progressFill').style.width = percentage + '%';
            document.getElementById('progressText').textContent = `${completedProducts}/${totalProducts} ÏôÑÏÑ±`;
        }
        
        // ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò Ìï®ÏàòÎì§
        function previousProduct() {
            console.log('Ïù¥Ï†Ñ ÏÉÅÌíà');
        }
        
        function nextProduct() {
            console.log('Îã§Ïùå ÏÉÅÌíà');
        }
        
        function saveCurrentProduct() {
            console.log('ÌòÑÏû¨ ÏÉÅÌíà Ï†ÄÏû•');
            alert('ÏÉÅÌíàÏù¥ Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§!');
        }
        
        function completeProduct() {
            if (currentKeywordIndex !== -1 && currentProductIndex !== -1) {
                const product = keywords[currentKeywordIndex].products[currentProductIndex];
                product.status = 'completed';
                updateUI();
                alert('ÏÉÅÌíàÏù¥ ÏôÑÎ£åÎêòÏóàÏäµÎãàÎã§!');
            }
        }
        
        function saveAll() {
            console.log('Ï†ÑÏ≤¥ Ï†ÄÏû•');
            alert('Î™®Îì† ÎÇ¥Ïö©Ïù¥ Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§!');
        }
        
        // ÏóîÌÑ∞ÌÇ§Î°ú Ï†úÎ™© ÏÉùÏÑ±
        document.getElementById('titleKeyword').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                generateTitles();
            }
        });
    </script>
</body>
</html>